<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bratify Clone</title>
  <style>
    :root {
      --color-bg: #f9fafb;
      --color-text: #111827;
      --color-border: #d1d5db;
      --color-preview-bg: #ffffff;
      --color-primary: #4f46e5;
      --color-secondary: #e5e7eb;
      --color-green: #22c55e;
      --color-footer: #888;
      --transition-fast: 180ms;
      --transition-medium: 300ms;
    }

    /* Dark mode variables (applied when body.dark-mode present) */
    body.dark-mode {
      --color-bg: #0b1020;
      --color-text: #e6eef8;
      --color-border: #2b2f3a;
      --color-preview-bg: #0f1724;
      --color-primary: #6366f1;
      --color-secondary: #1f2937;
      --color-green: #06b6d4;
      --color-footer: #aaa;
    }

    body {
      font-family: Arial, sans-serif;
      background: var(--color-bg);
      color: var(--color-text);
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: background var(--transition-medium) ease, color var(--transition-medium) ease;
      min-height: 100vh;
    }

    h1 { margin-bottom: 10px; }
    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      width: 90%;
      max-width: 1100px;
    }

    textarea {
      width: 100%;
      height: 150px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid var(--color-border);
      border-radius: 6px;
      resize: none;
      background: var(--color-preview-bg);
      color: var(--color-text);
      transition: background var(--transition-fast) ease, color var(--transition-fast) ease, border-color var(--transition-fast) ease;
    }

    .controls label {
      display: block;
      font-size: 14px;
      margin-top: 10px;
    }

    select, input[type="color"], input[type="range"] {
      width: 100%;
      margin-top: 5px;
      background: var(--color-preview-bg);
      color: var(--color-text);
      transition: background var(--transition-fast) ease, color var(--transition-fast) ease;
    }

    .preview {
      border: 1px solid var(--color-border);
      border-radius: 6px;
      min-height: 250px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: var(--color-preview-bg);
      transition: background var(--transition-medium) ease, border-color var(--transition-medium) ease;
    }

    /* helper classes to replace inline styles */
    .inline-controls { display:inline-flex; align-items:center; gap:10px; margin-top:8px; }
    .row-controls { display:flex; gap:8px; align-items:center; }
    .small-reset { margin-left:6px; }
    .center-block { margin-top:20px; text-align:center; }
    footer.site-footer { width:100%; text-align:center; margin-top:40px; color:var(--color-footer); font-size:14px; }

    /* Responsive layout: stack columns under 800px */
    @media (max-width: 800px) {
      .container { grid-template-columns: 1fr; }
      .inline-controls { flex-direction:column; align-items:stretch; gap:8px; }
      .row-controls { flex-wrap:wrap; }
      .mode-toggle { right: 12px; top: 12px; padding:6px 12px; }
      .preview { min-height: 180px; }
    }

    /* Make preview text draggable */
    #previewText {
      touch-action: none; /* enable pointer events without pan gestures */
      -webkit-user-select: none;
      user-select: none;
      cursor: grab;
      transition: transform 120ms ease;
      display: inline-block;
    }

    .buttons {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    button {
      padding: 8px 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background var(--transition-fast) ease, color var(--transition-fast) ease, transform 120ms ease;
    }

    button.primary { background: var(--color-primary); color: white; }
    button.secondary { background: var(--color-secondary); }
    button.green { background: var(--color-green); color: white; }

    /* Mode toggle button (top-right) */
    .mode-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 100;
      padding: 7px 20px;
      border-radius: 20px;
      background: var(--color-secondary);
      color: var(--color-text);
      border: 1px solid var(--color-border);
      font-size: 15px;
      cursor: pointer;
      transition: background var(--transition-fast) ease, color var(--transition-fast) ease, transform 120ms ease;
    }

    /* Small press animation class - applied briefly via JS */
    .mode-toggle.anim { transform: scale(0.96); }

    @font-face {
      font-family: "ThatThatNewPixel";
      src: url("thatthatnewpixelfamilytest-round.otf") format("opentype");
      font-display: swap;
    }
  </style>
</head>
<body>
  <button id="modeToggle" class="mode-toggle" aria-pressed="false">🌙 Dark Mode</button>
  <h1>Bratify-Style Text Styler</h1>
  <div class="container">
    <div class="controls">
      <label for="textInput">Text</label>
      <textarea id="textInput">Type your text here...</textarea>

      <label for="textColor">Text Color</label>
      <input type="color" id="textColor" value="#111827">

      <label for="bgColor">Background</label>
      <input type="color" id="bgColor" value="#ffffff">

  <label for="bgUpload">Upload Background Image</label>
  <input type="file" id="bgUpload" accept="image/*">
  <button type="button" id="clearBg" class="small-reset">Clear Background Image</button>

      <label for="fontSize">Font Size (px)</label>
      <input type="range" id="fontSize" min="12" max="200" value="48">
      <span id="fontSizeValue">48</span>

      <label for="fontWeight">Weight</label>
      <select id="fontWeight">
        <option value="400">400</option>
        <option value="500">500</option>
        <option value="600">600</option>
        <option value="700" selected>700</option>
        <option value="800">800</option>
        <option value="900">900</option>
      </select>

      <label for="lineHeight">Line Height</label>
      <input type="range" id="lineHeight" min="0.8" max="2.5" step="0.1" value="1.2">
      <span id="lineHeightValue">1.2</span>

      <label for="textAlign">Alignment</label>
      <select id="textAlign">
        <option value="left">Left</option>
        <option value="center" selected>Center</option>
        <option value="right">Right</option>
      </select>

      <label for="fontFamily">Font</label>
      <select id="fontFamily">
        <option value="ThatThatNewPixel">That That New Pixel</option>
        <option value="Arial, sans-serif">Arial</option>
        <option value="Courier New, monospace">Monospace</option>
        <option value="Georgia, serif">Serif</option>
      </select>

      <label for="fontUpload">Upload Font</label>
      <input type="file" id="fontUpload" accept=".ttf,.otf,.woff,.woff2">

      <label for="rotateDeg">Rotate (deg)</label>
  <div class="row-controls">
        <button type="button" id="rotateLeft">◀</button>
        <input type="range" id="rotateDeg" min="0" max="360" value="0">
        <button type="button" id="rotateRight">▶</button>
        <span id="rotateValue">0°</span>
  <button type="button" id="resetRotate" class="small-reset">Reset</button>
      </div>

      <div class="buttons">
        <button class="primary" onclick="downloadPNG()">Download PNG</button>
        <button class="secondary" onclick="downloadTXT()">Download TXT</button>
        <button class="green" onclick="copyText()">Copy</button>
      </div>
    </div>

    <div class="preview" id="previewArea">
      <div id="previewText">Type your text here...</div>
    </div>
  <div class="center-block">
      <strong>Resize / Adjust the Ratio:</strong>
  <div class="inline-controls">
        <label for="previewWidth">Width %</label>
        <input type="range" id="previewWidth" min="20" max="100" value="100">
        <span id="previewWidthValue">100</span>
        <label for="previewHeight">Height %</label>
        <input type="range" id="previewHeight" min="20" max="100" value="100">
        <span id="previewHeightValue">100</span>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    // Dark/Light mode persistence and toggle
    (function() {
      const modeToggle = document.getElementById('modeToggle');
      const darkClass = 'dark-mode';

      function setMode(isDark) {
        document.body.classList.toggle(darkClass, isDark);
        modeToggle.textContent = isDark ? '☀️ Light Mode' : '🌙 Dark Mode';
        modeToggle.setAttribute('aria-pressed', isDark ? 'true' : 'false');
        try { localStorage.setItem('bratify-dark', isDark ? '1' : '0'); } catch (e) {}
      }

      // Load saved preference
      try {
        const saved = localStorage.getItem('bratify-dark');
        if (saved === '1') setMode(true);
      } catch (e) {}

      modeToggle.addEventListener('click', () => {
          const isDark = document.body.classList.toggle(darkClass);
          // briefly animate the button
          modeToggle.classList.add('anim');
          setTimeout(() => modeToggle.classList.remove('anim'), 120);
          setMode(isDark);
      });
    })();

    const textInput = document.getElementById("textInput");
    const textColor = document.getElementById("textColor");
    const bgColor = document.getElementById("bgColor");
    const fontSize = document.getElementById("fontSize");
    const fontSizeValue = document.getElementById("fontSizeValue");
    const fontWeight = document.getElementById("fontWeight");
    const lineHeight = document.getElementById("lineHeight");
    const lineHeightValue = document.getElementById("lineHeightValue");
    const textAlign = document.getElementById("textAlign");
    const fontFamily = document.getElementById("fontFamily");
    const previewText = document.getElementById("previewText");
    const previewArea = document.getElementById("previewArea");
    const fontUpload = document.getElementById("fontUpload");
    // Flip controls (may be absent if user reverted previous edits)
    const flipHorizontal = document.getElementById('flipHorizontal');
    const flipVertical = document.getElementById('flipVertical');
    const resetTransform = document.getElementById('resetTransform');
    // Rotation elements (already present in DOM)
    const rotateDeg = document.getElementById('rotateDeg');
    const rotateValue = document.getElementById('rotateValue');
    const rotateLeft = document.getElementById('rotateLeft');
    const rotateRight = document.getElementById('rotateRight');
    const resetRotate = document.getElementById('resetRotate');
    const previewWidth = document.getElementById("previewWidth");
    const previewWidthValue = document.getElementById("previewWidthValue");
    const previewHeight = document.getElementById("previewHeight");
    const previewHeightValue = document.getElementById("previewHeightValue");
  const bgUpload = document.getElementById('bgUpload');
  const clearBg = document.getElementById('clearBg');
  let currentBgUrl = null;
  let flipX = false;
  let flipY = false;
  let rotation = 0; // degrees
  // Drag/translate state (percent of preview area)
  let tx = 0, ty = 0; // translation in percent
  let isDragging = false;
  let dragStart = { x: 0, y: 0 };

    function updatePreview() {
      previewText.textContent = textInput.value;
      previewText.style.color = textColor.value;
      // If a background image is set via upload, prefer that; otherwise use color
      if (currentBgUrl) {
        previewArea.style.background = `url('${currentBgUrl}') center/cover no-repeat`;
      } else {
        previewArea.style.background = bgColor.value;
      }
      previewText.style.fontSize = fontSize.value + "px";
      fontSizeValue.textContent = fontSize.value;
      previewText.style.fontWeight = fontWeight.value;
      previewText.style.lineHeight = lineHeight.value;
      lineHeightValue.textContent = lineHeight.value;
      previewText.style.textAlign = textAlign.value;
      previewText.style.fontFamily = fontFamily.value;
  // Compose transform: translate, then scale (flips), then rotate
  const sx = flipX ? -1 : 1;
  const sy = flipY ? -1 : 1;
  previewText.style.transform = `translate(${tx}%, ${ty}%) scale(${sx}, ${sy}) rotate(${rotation}deg)`;
      // Actually resize preview area
      previewArea.style.width = previewWidth.value + '%';
      previewArea.style.height = previewHeight.value + '%';
      previewWidthValue.textContent = previewWidth.value;
      previewHeightValue.textContent = previewHeight.value;
    }

    textInput.addEventListener("input", updatePreview);
    textColor.addEventListener("input", updatePreview);
    bgColor.addEventListener("input", updatePreview);
    fontSize.addEventListener("input", updatePreview);
    fontWeight.addEventListener("change", updatePreview);
    lineHeight.addEventListener("input", updatePreview);
    textAlign.addEventListener("change", updatePreview);
    fontFamily.addEventListener("change", updatePreview);
    previewWidth.addEventListener("input", updatePreview);
    previewHeight.addEventListener("input", updatePreview);

    bgUpload.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      if (currentBgUrl) {
        try { URL.revokeObjectURL(currentBgUrl); } catch (e) {}
      }
      currentBgUrl = URL.createObjectURL(file);
      updatePreview();
    });

    clearBg.addEventListener('click', () => {
      if (currentBgUrl) {
        try { URL.revokeObjectURL(currentBgUrl); } catch (e) {}
        currentBgUrl = null;
      }
      bgUpload.value = '';
      updatePreview();
    });

    fontUpload.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const url = URL.createObjectURL(file);
      const name = file.name.replace(/\..+$/, "");
      const newFontName = "UploadedFont_" + name;

      const style = document.createElement("style");
      style.innerHTML = `@font-face { font-family: '${newFontName}'; src: url('${url}'); }`;
      document.head.appendChild(style);

      const option = document.createElement("option");
      option.value = newFontName;
      option.textContent = "Uploaded: " + name;
      fontFamily.appendChild(option);
      fontFamily.value = newFontName;
      updatePreview();
    });

    // Wire flip controls if present
    if (flipHorizontal) {
      flipHorizontal.addEventListener('change', (e) => {
        flipX = !!e.target.checked;
        updatePreview();
      });
    }
    if (flipVertical) {
      flipVertical.addEventListener('change', (e) => {
        flipY = !!e.target.checked;
        updatePreview();
      });
    }
    if (resetTransform) {
      resetTransform.addEventListener('click', () => {
        flipX = false; flipY = false;
        if (flipHorizontal) flipHorizontal.checked = false;
        if (flipVertical) flipVertical.checked = false;
        previewText.style.transform = '';
        updatePreview();
      });
    }

    // Wire rotation controls if present
    if (rotateDeg) {
      rotateDeg.addEventListener('input', (e) => {
        rotation = parseInt(e.target.value, 10) || 0;
        if (rotateValue) rotateValue.textContent = rotation + '°';
        updatePreview();
      });
    }
    if (rotateLeft) {
      rotateLeft.addEventListener('click', () => {
        rotation = (rotation - 15 + 360) % 360;
        if (rotateDeg) rotateDeg.value = rotation;
        if (rotateValue) rotateValue.textContent = rotation + '°';
        updatePreview();
      });
    }
    if (rotateRight) {
      rotateRight.addEventListener('click', () => {
        rotation = (rotation + 15) % 360;
        if (rotateDeg) rotateDeg.value = rotation;
        if (rotateValue) rotateValue.textContent = rotation + '°';
        updatePreview();
      });
    }
    if (resetRotate) {
      resetRotate.addEventListener('click', () => {
        rotation = 0;
        if (rotateDeg) rotateDeg.value = rotation;
        if (rotateValue) rotateValue.textContent = rotation + '°';
        updatePreview();
      });
    }

    // Pointer-based dragging for previewText
    previewText.addEventListener('pointerdown', (e) => {
      isDragging = true;
      previewText.setPointerCapture(e.pointerId);
      dragStart.x = e.clientX;
      dragStart.y = e.clientY;
      previewText.style.cursor = 'grabbing';
    });

    window.addEventListener('pointermove', (e) => {
      if (!isDragging) return;
      const rect = previewArea.getBoundingClientRect();
      const dx = e.clientX - dragStart.x;
      const dy = e.clientY - dragStart.y;
      dragStart.x = e.clientX;
      dragStart.y = e.clientY;
      // convert to percent relative to preview area
      const dxPct = (dx / rect.width) * 100;
      const dyPct = (dy / rect.height) * 100;
      tx += dxPct;
      ty += dyPct;
      updatePreview();
    });

    window.addEventListener('pointerup', (e) => {
      if (!isDragging) return;
      isDragging = false;
      try { previewText.releasePointerCapture(e.pointerId); } catch (err) {}
      previewText.style.cursor = 'grab';
    });

    // Double-click on previewText to reset position
    previewText.addEventListener('dblclick', () => {
      tx = 0; ty = 0;
      updatePreview();
    });

    function downloadPNG() {
      html2canvas(previewArea, { backgroundColor: null, scale: 2 }).then(canvas => {
        const link = document.createElement("a");
        link.download = "bratified-text.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
      });
    }

    function downloadTXT() {
      const blob = new Blob([textInput.value], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "bratified-text.txt";
      link.click();
    }

    function copyText() {
      navigator.clipboard.writeText(textInput.value).then(() => {
        alert("Copied to clipboard!");
      });
    }

    // Set initial preview area size
    updatePreview();
  </script>
</body>
  <footer class="site-footer">
    2025 @ Jeyward - Bratify Free Use
  </footer>
</html>
